angular.module("admin").controller("cashAuditDetailsControl",["$rootScope","$scope","$state","cashService","$modal","commonUtil",function(a,t,e,s,c,d){function o(){var a=!1;return angular.forEach(h.list,function(t){""!=t.dealStatus&&null!=t.dealStatus||(a=!0)}),a}var h=this;h.batchNo=e.params.batchNo,h.searchParams=e.params,!function(){function a(a){if(a)return 1*a}h.searchParams.cashStart=a(h.searchParams.cashStart),h.searchParams.cashEnd=a(h.searchParams.cashEnd),h.searchParams.checkStart=a(h.searchParams.checkStart),h.searchParams.checkEnd=a(h.searchParams.checkEnd),delete h.searchParams.batchNo}(),h.cashDetailsGo=function(){e.go(e.current,d.querySearchParams(h.searchParams),{reload:!0})},h.cleanSearch=function(){angular.forEach(h.searchParams,function(a,t){h.searchParams[t]=""}),h.cashDetailsGo()},s.cashDetails(h.batchNo,1,h.searchParams).then(function(t){0===t.data.code?(h.list=t.data.data,h.total=t.data.total,h.isNeedAllDeal=o(),h.all=function(){h.list=d.allList(h.list,h.allBtn)},h.onlyClick=function(){h.allBtn=d.isAllChoice(h.list)}):a.alert(t.data.message)}),h.getAuditReason=function(t){s.getAuditReason(t).then(function(t){var e;0===t.data.code?(e=t.data.reason||"未填写",a.cashConfirm("不予通过原因:",e,"确认")):a.alert(t.data.message)})},h.cashAudits=function(){return h.detailList=[],h.ids=[],angular.forEach(h.list,function(a){a.choice&&1==a.checkStatus&&h.ids.push(a.id)}),0==h.ids.length?(a.alert("请选中需要批量通过的数据"),!1):(h.checkMoneyListModal.show(),void s.getCashAuditListDetail(h.ids).then(function(a){0==a.data.code&&(h.detailList=a.data.data)}))},h.checkCashAudits=function(){var a={ids:angular.copy(h.ids),type:1,batchNo:h.batchNo};s.checkCashAuditList(a).then(function(a){0==a.data.code&&(h.cashDetailsGo(),h.checkMoneyListModal.hide())})},h.cashAudit={data:{}},h.checkMoneyModalFun=function(a){h.detailList=[],h.cashAudit.data.withdrawalsId=a,h.checkMoneyModal.show(),delete h.cashAudit.data.reason,s.getCashAuditOneDetails(a).then(function(a){0==a.data.code&&h.detailList.push(a.data.data)})},h.modal=function(a){h.cashAudit.data.withdrawalsId=a,h.cashAuditModal.show()},h.cashAuditReason=function(){h.cashAuditModal.hide(),h.cashAuditReasonModal.show()},h.agree=function(){h.cashAudit.data.type=1,delete h.cashAudit.data.reason,h.cashAudit.data.status=1,s.cashAudit(h.cashAudit.data).then(function(t){0===t.data.code?(h.cashAuditModal.hide(),h.checkMoneyModal.hide(),h.cashDetailsGo()):a.alert(t.data.message)})},h.fail=function(){h.cashAudit.data.type=1,h.cashAudit.data.status=2,s.cashAudit(h.cashAudit.data).then(function(t){0===t.data.code?(h.cashDetailsGo(),h.cashAuditReasonModal.hide(),h.checkMoneyModal.hide()):a.alert(t.data.message)})},h.checkMoneyModal=c({templateUrl:"checkMoneyModal.html",scope:t,show:!1}),h.checkMoneyListModal=c({templateUrl:"checkMoneyListModal.html",scope:t,show:!1}),h.cashAuditModal=c({templateUrl:"cashAudit.html",scope:t,show:!1}),h.cashAuditReasonModal=c({templateUrl:"cashAuditReason.html",scope:t,show:!1})}]);