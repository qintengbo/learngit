angular.module("admin").controller("cashHandleDetailsControl",["$rootScope","$scope","$modal","$state","cashService","commonUtil",function(a,e,t,s,c,n){function d(){var a=!1;return angular.forEach(l.list,function(e){""!=e.dealStatus&&null!=e.dealStatus&&4!=e.dealStatus||(a=!0)}),a}var l=this;l.batchNo=s.params.batchNo,l.searchParams=s.params,!function(){function a(a){if(a)return 1*a}l.searchParams.cashStart=a(l.searchParams.cashStart),l.searchParams.cashEnd=a(l.searchParams.cashEnd),l.searchParams.checkStart=a(l.searchParams.checkStart),l.searchParams.checkEnd=a(l.searchParams.checkEnd),delete l.searchParams.batchNo}(),l.cashDetailsGo=function(){s.go(s.current,n.querySearchParams(l.searchParams),{reload:!0})},l.cleanSearch=function(){angular.forEach(l.searchParams,function(a,e){l.searchParams[e]=""}),l.cashDetailsGo()},c.cashDetails(l.batchNo,2,l.searchParams).then(function(e){0===e.data.code?(l.list=e.data.data,l.total=e.data.total,l.isNeedAllDeal=d(),l.all=function(){l.list=n.allList(l.list,l.allBtn)},l.onlyClick=function(){l.allBtn=n.isAllChoice(l.list)}):a.alert(e.data.message)}),l.getExcel=function(){return l.detailList=[],l.ids=[],angular.forEach(l.list,function(a){a.choice&&l.ids.push(a.id)}),0==l.ids.length?(a.alert("请选中需要导出Excel的数据"),!1):void c.getCashAuditListDetail(l.ids,"excel").then(function(e){if(0==e.data.code){var t=location.origin+e.data.url;location.href=t}else a.alert(e.data.message)})},l.checkCashHandleList={getCashHandleListDetail:function(){return l.detailList=[],l.ids=[],angular.forEach(l.list,function(a){a.choice&&4==a.dealStatus&&l.ids.push(a.id)}),0==l.ids.length?(a.alert("请选中需要批量通过的数据"),!1):(l.checkMoneyListModal.show(),void c.getCashAuditListDetail(l.ids).then(function(a){0==a.data.code&&(l.detailList=a.data.data)}))},checkCashHandleList:function(){var a={ids:angular.copy(l.ids),type:2,batchNo:l.batchNo};c.checkCashAuditList(a).then(function(a){0==a.data.code&&(l.checkMoneyListModal.hide(),l.cashDetailsGo())})}},l.cashHandleReason=function(e){c.getAuditReason(e).then(function(e){0===e.data.code?(e.data.data.message=e.data.data.message||"未填写",a.cashConfirm("提现失败:",message,"确认")):a.cashConfirm("提现失败:","未填写","确认")})},l.checkCashHandle={data:{}},l.cashAuditReason=function(){l.cashHandleReasonModal.show(),l.cashHandleModal.hide()},l.getCashHandleOneDetail=function(a){l.checkCashHandle.data.withdrawalsId=a,l.checkCashHandle.data.type=2,l.detailList=[],l.checkMoneyModal.show(),delete l.checkCashHandle.data.reason,c.getCashAuditOneDetails(a).then(function(a){0==a.data.code&&l.detailList.push(a.data.data)})},l.pass=function(){l.checkCashHandle.data.status=1,delete l.checkCashHandle.data.reason,c.cashAudit(l.checkCashHandle.data).then(function(e){0===e.data.code?(l.cashHandleModal.hide(),l.checkMoneyModal.hide(),l.cashDetailsGo()):a.alert(e.data.message)})},l.fail=function(){l.checkCashHandle.data.status=2,c.cashAudit(l.checkCashHandle.data).then(function(e){0===e.data.code?(l.cashHandleModal.hide(),l.checkMoneyModal.hide(),l.cashHandleReasonModal.hide(),l.cashDetailsGo()):a.alert(e.data.message)})},l.checkMoneyModal=t({templateUrl:"checkMoneyModal.html",scope:e,show:!1}),l.checkMoneyListModal=t({templateUrl:"checkMoneyListModal.html",scope:e,show:!1}),l.cashHandleModal=t({templateUrl:"cashAudit.html",scope:e,show:!1}),l.cashHandleReasonModal=t({templateUrl:"cashHandleReasonModal.html",scope:e,show:!1})}]);